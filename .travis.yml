language: bash
os: linux
dist: buster
services:
  - docker
addons:
  apt:
    packages:
      - docker-ce
jobs:
  include:
    - stage: Base Production image
      script:
      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - docker build --compress -t epicmorg/prod:latest epicmorg/prod
      - docker push epicmorg/prod:latest
      
    - stage: Base develop image
      script:
      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - docker build --compress -t epicmorg/devel:latest epicmorg/devel
      - docker push epicmorg/devel:latest
      
    - stage: Nginx image
      script:
      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - docker build --compress -t epicmorg/balancer:latest balancer/latest
      - docker push epicmorg/balancer:latest
      
    - stage: Nginx-php image
      script:
      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - docker build --compress -t epicmorg/balancer:php balancer/php
      - docker push epicmorg/balancer:php
      
    - stage: TeamCityAgent image
      script:
      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - docker build --compress -t epicmorg/teamcity-agent:latest teamcity-agent
      - docker push epicmorg/teamcity-agent:latest
      
    - stage: Jira Latest image
      script:
      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - docker build --compress -t epicmorg/jira:latest jira/latest
      - docker push epicmorg/jira:latest
      
    - stage: Jira 7.10.0 image
      script:
      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - docker build --compress -t epicmorg/jira:7.10.0 jira/7.10.0
      - docker push epicmorg/jira:7.10.0
      
    - stage: Jira 7.13.3 image
      script:
      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - docker build --compress -t epicmorg/jira:7.13.3 jira/7.13.3
      - docker push epicmorg/jira:7.13.3
      
#future migrated builds
#    - stage: Confluence image
#      script: docker build --compress -t epicmorg/confluence:latest  confluence/latest
#    - stage: Bitbucket image
#      script: docker build --compress -t epicmorg/bitbucket:latest  bitbucket/latest
