language: bash
os: linux
dist: buster
services:
  - docker
addons:
  apt:
    packages:
      - docker-ce

jobs:
  include:
    - stage: Base Production image
      script: echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin && docker build --rm --compress --force-rm -t epicmorg/prod:latest epicmorg/prod && docker push epicmorg/prod:latest
    - stage: Base develop image
      script: echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin && docker build --rm --compress --force-rm -t epicmorg/devel:latest epicmorg/devel  && docker push epicmorg/devel:latest
    - stage: Nginx image
      script: docker build --rm --compress --force-rm -t epicmorg/balancer:latest balancer/latest
    - stage: Nginx-php image
      script: docker build --rm --compress --force-rm -t epicmorg/balancer:php balancer/php
    - stage: TeamCityAgent image
      script: docker build --rm --compress --force-rm -t epicmorg/teamcity-agent:latest teamcity-agent
    - stage: Jira image
      script: docker build --rm --compress --force-rm -t epicmorg/jira:latest jira/latest
    - stage: Jira 7.10.0 image
      script: docker build --rm --compress --force-rm -t epicmorg/jira:latest jira/7.10.0
    - stage: Jira lts image
      script: docker build --rm --compress --force-rm -t epicmorg/jira:latest jira/7.13.3
#future migrated builds
#    - stage: Confluence image
#      script: docker build --rm --compress --force-rm -t epicmorg/confluence:latest  confluence/latest
#    - stage: Bitbucket image
#      script: docker build --rm --compress --force-rm -t epicmorg/bitbucket:latest  bitbucket/latest
